define(['jquery','Magento_Ui/js/grid/columns/column','uiLayout'],function($,Column,layout){'use strict';return Column.extend({defaults:{bodyTmpl:'Magento_MediaGalleryUi/grid/columns/image',deleteImageUrl:'media_gallery/image/delete',addSelectedBtnSelector:'#add_selected',deleteSelectedBtnSelector:'#delete_selected',selected:null,fields:{id:'id',url:'url',alt:'name'},modules:{actions:'${ $.name }_actions',provider:'${ $.provider }',messages:'${ $.messagesName }'},imports:{activeDirectory:'${ $.mediaGalleryDirectoryComponent }:activeNode'},listens:{activeDirectory:'selectDirectoryHandle'},viewConfig:[{component:'Magento_MediaGalleryUi/js/grid/columns/image/actions',name:'${ $.name }_actions',imageModelName:'${ $.name }'}]},initialize:function(){this._super();this.initView();$(window).on('fileDeleted.enhancedMediaGallery',this.reloadMediaGrid.bind(this));$(window).on('reload.MediaGallery',this.reloadGrid.bind(this));return this;},initObservable:function(){this._super().observe(['selected']);return this;},getUrl:function(record){return record[this.fields.url];},getId:function(record){return record[this.fields.id];},getImageAlt:function(record){return record[this.fields.alt];},isSelected:function(record){if(this.selected()===null){return false;}
return this.getId(this.selected())===this.getId(record);},clickOnImage:function(record,collapsibleOpened){if(!collapsibleOpened){this.select(record);}},clickOnThreeDots:function(record,collapsibleOpened){if(!this.isSelected(record)||collapsibleOpened){this.select(record);}},select:function(record){this.isSelected(record)?this.selected(null):this.selected(record);this.toggleAddSelectedButton();},deselectImage:function(){this.selected(null);this.toggleAddSelectedButton();},getSelected:function(){return this.selected();},initView:function(){layout(this.viewConfig);return this;},toggleAddSelectedButton:function(){if(this.selected()===null){this.hideAddSelectedAndDeleteButon();}else{$(this.addSelectedBtnSelector).removeClass('no-display');$(this.deleteSelectedBtnSelector).removeClass('no-display');}},hideAddSelectedAndDeleteButon:function(){$(this.addSelectedBtnSelector).addClass('no-display');$(this.deleteSelectedBtnSelector).addClass('no-display');},reloadMediaGrid:function(e,data){if(data.reload){this.reloadGrid();}
if(data.message&&data.code){this.addMessage(data.code,data.message);}
this.hideAddSelectedAndDeleteButon();},reloadGrid:function(){var provider=this.provider(),dataStorage=provider.storage();dataStorage.clearRequests();provider.reload();},addMessage:function(code,message){this.messages().add(code,message);this.messages().scheduleCleanup();},selectDirectoryHandle:function(path){if(this.selected()&&this.selected().directory!==path){this.deselectImage();}}});});